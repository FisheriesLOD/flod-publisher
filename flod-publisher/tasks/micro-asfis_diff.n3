@prefix sr:   <http://semanticrepository/task#> .
@prefix dct:  <http://purl.org/dc/terms/> . 
@prefix skos: <http://www.w3.org/2004/02/skos/core#> .

<sr:task>                     a sr:Task ;

sr:source_endpoint           <http://168.202.3.223:3030/sr_staging/query> ;

sr:source_graph              <http://semanticrepository/staging/graph/1.1/micro_asfis_diff> ;

sr:publication_endpoint      <http://168.202.3.223:3030/sr_public/update> ;

sr:target_graph              <http://semanticrepository/public/graph/1.1/micro_asfis> ;

#sr:depending_graph          <http://semanticrepository/graph/depending_graph2> ;
#sr:depending_graph          <http://semanticrepository/graph/depending_graph1> ;

dct:creator                  <http://semanticrepository/people/claudio.baldassarre> ;
skos:editorialNote           "Generated by the Semantic Repository LOD maintenance framework" ;

sr:diff_query """ 
    SELECT DISTINCT ?code 
        WHERE {
                ?code <http://www.ontologydesignpatterns.org/cp/owl/classification.owl#classifies> ?o
              } """;

sr:query     """
  PREFIX  rdfs: <http://www.w3.org/2000/01/rdf-schema#>
  PREFIX  cls:  <http://www.fao.org/figis/flod/onto/codedentityclassification.owl#>
  PREFIX  fn:   <http://www.w3.org/2005/xpath-functions#>
   
  CONSTRUCT 
    { ?coded_entity <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.fao.org/figis/flod/onto/codedentity.owl#CodedEntity> .
      ?coded_entity cls:isClassfiedByCode ?code .
      ?code <http://www.w3.org/1999/02/22-rdf-syntax-ns#type> <http://www.fao.org/figis/flod/onto/linneanspecies.owl#SpeciesCode> .
      ?code rdfs:label ?alpha_code .
      ?code <http://www.ontologydesignpatterns.org/cp/owl/classification.owl#classifies> ?coded_entity .}
 WHERE
   { ?x <s:r/Codelist> ?system_raw .
     ?system_raw <s:r/id> ?id
     BIND(iri(fn:concat("http://www.fao.org/figis/flod/entities/codificationsystem/", fn:lower-case(str(?id)))) AS ?system)
     ?t <s:r/Code> ?code_raw .
     ?code_raw <s:r/id> ?alpha_code
     BIND(iri(fn:concat("http://www.fao.org/figis/flod/entities/speciescode/", fn:lower-case(str(?alpha_code)))) AS ?code)
     BIND(iri(fn:concat("http://www.fao.org/figis/flod/entities/codedentity/", STRUUID())) AS ?coded_entity)
   }""";
.

